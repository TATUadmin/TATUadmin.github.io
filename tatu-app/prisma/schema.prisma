generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Analytics {
  id             String           @id
  itemId         String           @unique
  views          Int              @default(0)
  uniqueViews    Int              @default(0)
  lastUpdated    DateTime
  PortfolioItem  PortfolioItem    @relation(fields: [itemId], references: [id], onDelete: Cascade)
  DailyAnalytics DailyAnalytics[]

  @@index([itemId])
}

model Appointment {
  id                              String            @id
  notes                           String?
  createdAt                       DateTime          @default(now())
  updatedAt                       DateTime
  shopId                          String
  artistId                        String
  clientId                        String
  endTime                         DateTime
  serviceId                       String
  startTime                       DateTime
  status                          AppointmentStatus @default(PENDING)
  User_Appointment_artistIdToUser User              @relation("Appointment_artistIdToUser", fields: [artistId], references: [id])
  User_Appointment_clientIdToUser User              @relation("Appointment_clientIdToUser", fields: [clientId], references: [id])
  Service                         Service           @relation(fields: [serviceId], references: [id])
  Shop                            Shop              @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@index([artistId])
  @@index([clientId])
  @@index([serviceId])
  @@index([shopId])
}

model Comment {
  id            String        @id
  content       String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  userId        String
  itemId        String
  parentId      String?
  PortfolioItem PortfolioItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  Comment       Comment?      @relation("CommentToComment", fields: [parentId], references: [id], onDelete: Cascade)
  other_Comment Comment[]     @relation("CommentToComment")
  User          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([itemId])
  @@index([parentId])
  @@index([userId])
}

model ConnectedAccount {
  id           String          @id
  userId       String
  platform     MessagePlatform
  accountId    String
  accessToken  String
  refreshToken String?
  tokenExpiry  DateTime?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime
  lastSynced   DateTime?
  User         User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
  @@index([userId])
}

model DailyAnalytics {
  id          String    @id
  date        DateTime  @db.Date
  views       Int       @default(0)
  uniqueViews Int       @default(0)
  likes       Int       @default(0)
  comments    Int       @default(0)
  shares      Int       @default(0)
  analyticsId String
  Analytics   Analytics @relation(fields: [analyticsId], references: [id], onDelete: Cascade)

  @@unique([analyticsId, date])
  @@index([analyticsId])
  @@index([date])
}

model Like {
  id            String        @id
  createdAt     DateTime      @default(now())
  userId        String
  itemId        String
  PortfolioItem PortfolioItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  User          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId])
  @@index([itemId])
  @@index([userId])
}

model MessageAttachment {
  id             String         @id
  messageId      String
  fileName       String
  fileType       String
  fileSize       Int
  fileUrl        String
  createdAt      DateTime       @default(now())
  UnifiedMessage UnifiedMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model MessageThread {
  id             String           @id
  userId         String
  subject        String?
  participants   String[]
  lastMessageAt  DateTime
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  User           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  UnifiedMessage UnifiedMessage[]

  @@index([lastMessageAt])
  @@index([userId])
}

model PortfolioCollection {
  id            String          @id
  name          String
  description   String?
  coverImage    String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  userId        String
  User          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  PortfolioItem PortfolioItem[]

  @@index([userId])
}

model PortfolioItem {
  id                  String               @id
  title               String
  description         String?
  imageUrl            String
  tags                String[]
  style               String
  featured            Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  userId              String
  collectionId        String?
  order               Int                  @default(0)
  Analytics           Analytics?
  Comment             Comment[]
  Like                Like[]
  PortfolioCollection PortfolioCollection? @relation(fields: [collectionId], references: [id])
  User                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  Share               Share[]

  @@index([collectionId])
  @@index([order])
  @@index([userId])
}

model Profile {
  id                    String    @id
  bio                   String?
  avatar                String?
  phone                 String?
  instagram             String?
  website               String?
  location              String?
  specialties           String[]
  userId                String    @unique
  completedRegistration Boolean   @default(false)
  visibilityBoostActive Boolean   @default(false)
  visibilityBoostEndDate DateTime?
  User                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Review {
  id        String   @id
  rating    Int      @db.SmallInt
  content   String
  images    String[]
  createdAt DateTime @default(now())
  updatedAt DateTime
  userId    String
  shopId    String
  Shop      Shop     @relation(fields: [shopId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Service {
  id          String        @id
  name        String
  description String?
  duration    Int
  price       Float
  shopId      String
  artistId    String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  Appointment Appointment[]
  User        User?         @relation(fields: [artistId], references: [id])
  Shop        Shop          @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@index([artistId])
  @@index([shopId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Share {
  id            String        @id
  platform      String
  createdAt     DateTime      @default(now())
  userId        String?
  itemId        String
  PortfolioItem PortfolioItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  User          User?         @relation(fields: [userId], references: [id])

  @@index([itemId])
  @@index([platform])
  @@index([userId])
}

model Shop {
  id             String           @id
  name           String
  description    String?
  address        String
  city           String
  state          String
  zipCode        String
  phone          String?
  email          String?
  website        String?
  instagram      String?
  status         ShopStatus       @default(PENDING)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  ownerId        String
  Appointment    Appointment[]
  Review         Review[]
  Service        Service[]
  User           User             @relation(fields: [ownerId], references: [id])
  ShopsOnArtists ShopsOnArtists[]
}

model ShopsOnArtists {
  shopId   String
  artistId String
  joinedAt DateTime @default(now())
  User     User     @relation(fields: [artistId], references: [id])
  Shop     Shop     @relation(fields: [shopId], references: [id])

  @@id([shopId, artistId])
}

model UnifiedMessage {
  id                String              @id
  userId            String
  platform          MessagePlatform
  externalId        String?
  sender            String
  senderName        String?
  subject           String?
  content           String
  status            MessageStatus       @default(UNREAD)
  receivedAt        DateTime
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  labels            String[]
  threadId          String?
  MessageAttachment MessageAttachment[]
  MessageThread     MessageThread?      @relation(fields: [threadId], references: [id])
  User              User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([platform])
  @@index([receivedAt])
  @@index([status])
  @@index([userId])
}

model User {
  id                                     String                @id
  name                                   String?
  email                                  String                @unique
  emailVerified                          DateTime?
  password                               String
  role                                   UserRole              @default(CUSTOMER)
  createdAt                              DateTime              @default(now())
  updatedAt                              DateTime
  Account                                Account[]
  Appointment_Appointment_artistIdToUser Appointment[]         @relation("Appointment_artistIdToUser")
  Appointment_Appointment_clientIdToUser Appointment[]         @relation("Appointment_clientIdToUser")
  Comment                                Comment[]
  ConnectedAccount                       ConnectedAccount[]
  Like                                   Like[]
  MessageThread                          MessageThread[]
  PortfolioCollection                    PortfolioCollection[]
  PortfolioItem                          PortfolioItem[]
  Profile                                Profile?
  Review                                 Review[]
  Service                                Service[]
  Session                                Session[]
  Share                                  Share[]
  Shop                                   Shop[]
  ShopsOnArtists                         ShopsOnArtists[]
  UnifiedMessage                         UnifiedMessage[]
}

model VerificationToken {
  id        String   @id
  token     String   @unique
  email     String
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
  @@index([email])
}

model ViewerSession {
  id        String   @id
  sessionId String
  itemId    String
  firstView DateTime @default(now())
  lastView  DateTime

  @@unique([sessionId, itemId])
  @@index([itemId])
  @@index([sessionId])
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum MessagePlatform {
  EMAIL
  INSTAGRAM
  FACEBOOK
  X_TWITTER
  INTERNAL
}

enum MessageStatus {
  UNREAD
  READ
  ARCHIVED
  DELETED
}

enum ShopStatus {
  PENDING
  ACTIVE
  INACTIVE
}

enum UserRole {
  CUSTOMER
  ARTIST
  SHOP_OWNER
  ADMIN
}
